# D02\_LinuxNetwork-0 genevaja

## Part 1. Инструмент ipcalc
### 1.1 Сети и маски
- Определить адрес сети 192.167.38.54/13
- ![ipcalc 192.167.38.54/13](./images/part_1_1.png "ipcalc 192.167.38.54/13")
- Перевод маски в префиксную и двоичную запись
- ![ipcalc 255.255.255.0](./images/part_1_1_1.png "ipcalc 255.255.255.0")
- ![ipcalc 0.0.0.0/15](./images/part_1_1_2.png "ipcalc 0.0.0.0/15")
- Для перевода двоичной записи в обычную используются значения октетов. Например, для адреса 
11111111.11111111.11111111.11110000 маска будет равняться 255.255.255.240. Для отображения префиксной записи маски необходимо посчитать количество единиц. Для примера выше форма записи будет /28
- Минимальный и максимальный хост в сети 12.167.38.4 при маске /8
- ![ipcalc 12.167.38.4/8](./images/part_1_2_1.png "ipcalc 12.167.38.4/8")
- Минимальный и максимальный хост в сети 12.167.38.4 при маске 11111111.11111111.00000000.00000000
- ![ipcalc 12.167.38.4/16](./images/part_1_2_2.png "ipcalc 12.167.38.4/16")
- Минимальный и максимальный хост в сети 12.167.38.4 при маске 255.255.254.0
- ![ipcalc 12.167.38.4/255.255.254.0](./images/part_1_2_3.png "ipcalc 12.167.38.4/255.255.254.0")
- Минимальный и максимальный хост в сети 12.167.38.4 при маске /4
- ![ipcalc 12.167.38.4/4](./images/part_1_2_4.png "ipcalc 12.167.38.4/4")

### 1.2 localhost
- Только те адреса, которые начинаются на 127.х.х.х являются loopback адресами
- ![ipcalc loopback](./images/part_1_2_5.png "ipcalc 127.x.x.x")

### 1.3 Диапазоны и сегменты сетей
- В качестве публичного можно использовать только следующие адреса:
1. 134.43.0.2
2. 172.0.2.1
3. 192.172.0.1
4. 172.68.0.2
5. 192.169.168.1
- ![ipcalc](./images/part_1.3_1.png "Вывод всех адресов в ipcalc")
- Остальные адреса могут работать только в качестве частных
- Для сети 10.10.0.0/18 шлюзами могут быть адреса из диапазона hostmin-hostmax
То есть 10.10.0.2 10.10.10.10
- ![ipcalc 1.3](./images/part_1.3_2.png "ipcalc 10.10.0.0/18")

## Part 2. Статическая маршрутизация между двумя машинами
- ![part 2.0 ws1](./images/part_2.0_ws1.png "ws1")
- ![part 2.0 ws2](./images/part_2.0_ws2.png "ws2")
1. ws1 - Внутренней сети соответствует интерфейс enp0s8
2. ws2 - Внутренней сети соответствует интерфейс enp0s8 (точное соответствие с ws1 из-за клонирования)
- ![part 2.0 ws1 yaml](./images/part_2.0_ws1_yaml.png "Содержимое файла 00-installer-config.yaml у ws1")
- ![part 2.0 ws2 yaml](./images/part_2.0_ws2_yaml.png "Содержимое файла 00-installer-config.yaml у ws2")
- ![part 2.0 ws1 netplan apply](./images/part_2.0_ws1_netplan.png "Вывод команды netplan apply y ws1")
- ![part 2.0 ws2 netplan apply](./images/part_2.0_ws2_netplan.png "Вывод команды netplan apply y ws2")
### 2.1 Добавление статического маршрута вручную
- ![part 2.1 ws1](./images/part_2.1_ws1.png "Ручной маршрут и пинг второй машины")
- ![part 2.1 ws2](./images/part_2.1_ws2.png "Ручной маршрут и пинг первой машины")
### 2.2 Добавление статического маршрута с сохранением
- ![part 2.2 ws1 yaml](./images/part_2.2_ws1_yaml.png "yaml файл ws1")
- ![part 2.2 ws2 yaml](./images/part_2.2_ws2_yaml.png "yaml файл ws2")
- ![part 2.2 ws1](./images/part_2.2_ws1.png "Вывод маршрута и пинг второй машины")
- ![part 2.2 ws2](./images/part_2.2_ws2.png "Вывод маршрута и пинг первой машины")
## Part 3. Утилита iperf3
### 3.1 Перевести и записать в отчёт: 
- 8 Mbps = 1000 B/s = 1 MB/s
- 100 MB/s = 100000 KB/s = 800000 kbs
- 1 Gbps = 1000 Mbps
### 3.2 Утилита iperf3
- Для замеров скорости я предварительно включил проверяемую машину в режим сервера при помощи команды iperf3 -s
- ![part 3.2 ws1](./images/part_3.2_ws1_to_ws2.png "Замер скорости между ws1 и ws2. ws2 на данный момент работает в режиме сервера")
- ![part 3.2 ws2](./images/part_3.2_ws2_to_ws1.png "Замер скорости между ws2 и ws1. ws1 на данный момент работает в режиме сервера")
## Part 4. Сетевой экран
### 4.1 Утилита iptables
- ![part 4.1 ws1](./images/part_4.1_ws1.png "Вывод файла firewall.sh и таблицы iptables для ws1")
- ![part 4.1 ws2](./images/part_4.1_ws2.png "Вывод файла firewall.sh и таблицы iptables для ws2")
- Стратегия первого файла предполагает сначала запрет на OUTPUT если идёт запрос по протоколу icmp
- Стратегия второго файла предполагает сначала разрешение на OUTPUT если идёт запрос по протоколу icmp
### 4.2 Утилита nmap
- ![part 4.2 ws2](./images/part_4.2_ws2.png "Вывод nmap")
- ![part 4.3](./images/part_4.3.png "Сохранение дампов")
## Part 5. Статическая маршрутизация сети
### 5.1 Настройка адресов машин
- ![part 5.1 ws11](./images/part_5.1_ws11.png "Общий вывод для ws11")
- ![part 5.1 ws21](./images/part_5.1_ws21.png "Общий вывод для ws21")
- ![part 5.1 ws22](./images/part_5.1_ws22.png "Общий вывод для ws22")
- ![part 5.1 r1](./images/part_5.1_r1.png "Общий вывод для r1")
- ![part 5.1 r2](./images/part_5.1_r2.png "Общий вывод для r2")
### 5.2 Включение переадресасии IP-адресов
- Временная переадресация
- ![part 5.2 r1](./images/part_5.2_r1.png "r1")
- ![part 5.2 r2](./images/part_5.2_r2.png "r1")
- Постоянная переадресация
- ![part 5.2.1 r1](./images/part_5.2.1_r1.png "r1")
- ![part 5.2.1 r2](./images/part_5.2.2_r2.png "r1")
### 5.3 Установка маршрута по-умолчанию
- ![part 5.3 ws11](./images/part_5.3.1_ws11_yaml.png "Вывод yaml файла для ws11")
- ![part 5.3 ws21](./images/part_5.3.1_ws21_yaml.png "Вывод yaml файла для ws21")
- ![part 5.3 ws22](./images/part_5.3.1_ws22_yaml.png "Вывод yaml файла для ws22")
- ![part 5.3.2 ws11](./images/part_5.3.2_ws11_ip_r.png "Вывод ip r для ws11")
- ![part 5.3.2 ws21](./images/part_5.3.2_ws21_ip_r.png "Вывод ip r для ws21")
- ![part 5.3.2 ws22](./images/part_5.3.2_ws22_ip_r.png "Вывод ip r для ws22")
- ![part 5.3 final](./images/part_5.3_final.png "Вывод tcpdump -tn -i eth1")
### 5.4 Добавление статических маршрутов
- ![part 5.4.1 r1](./images/part_5.4.1_r1.png "Содержимое файла 00-installer-config.yaml для r1")
- ![part 5.4.1 r2](./images/part_5.4.1_r2.png "Содержимое файла 00-installer-config.yaml для r2")
- ![part 5.4.2 r1](./images/part_5.4.2_r1.png "Вывод ip r для r1")
- ![part 5.4.2 r2](./images/part_5.4.2_r2.png "Вывод ip r для r2")
- ![part 5.5 ws11](./images/part_5.5_ws11.png "Вывод ip r list для ws11")
- Для адреса 10.10.0.0 был выбран маршрут, отличный от 0.0.0.0/0, так как последний означает отсутствие конкретного адреса в качестве следующего перехода на пути пакета к конечному получателю. Когда маршрут по умолчанию используется с маской подсети 0.0.0.0, он соответствует любому адресу.
### 5.5 Построение списка маршрутизаторов
- ![part 5.5.1 ws11](./images/part_5.5.1_ws11.png "Вывод traceroute ws11")
- ![part 5.5.1 r1](./images/part_5.5.1_r1.png "Вывод tcpdump на r1")
- Traceroute позволяет увидеть промежуточные узлы по путям следования пакетов. Программа отправляет по три ICMP пакета с разным уровнем "жизни" т.н. TTL. Этот параметр указывает на количество узлов, через которые может проходить пакет. При получении сигнала "time exceeded in transit" при повторном отправке пакета время TTL увеличивается на единицу, и так до тех пор, пока не будет достигнут узел получателя.
### 5.6 Использование протокола ICMP при маршрутизации
- ![part 5.5.2 ws11](./images/part_5.5.2_ws11.png "Ping несуществующего хоста на машине ws11")
- ![part 5.5.3 r1](./images/part_5.5.3_r1.png "tcpdump на r1")
## Part 6. Динамическая настройка IP с помощью DHCP
- В первую очередь пришлось установить isc-dhcp-server. Потом уже вносить изменения в файлы настройки
- ![part 6.1 r2](./images/part_6.1_r2_v2.png "Вывод файлов dhcpd.conf и resolv.conf для r1")
- ![part 6.2 ws21](./images/part_6.2_ws21.png "Вывод ip a и ping ws22 для ws21")
- ![part 6.2 ws11](./images/part_6.2_ws11.png "Вывод настроек netplan для ws11")
- ![part 6.2 r1](./images/part_6.2_r1.png "Вывод настроек dhcp у роутера r1")
- Для запроса нового ip я использовал команду dhclient -v enp0s8
- ![part 6.2 ws11 2](./images/part_6.2_ws11_2.png "Вывод ip a на ws11. Демонстрирую, что адрес получен")
### Part 7. NAT
- ![part 7.0 ws22](./images/part_7.0_ws22_2.png "Вывод /etc/apache2/ports.conf на ws22 и запуск сервера")
- ![part 7.0 r1](./images/part_7.0_r1_2.png "Вывод /etc/apache2/ports.conf на r1 и запуск сервера")
- ![part 7.1 ws22](./images/part_7.0_ws22_no_ping.png "Пинга нет")
- ![part 7.1 r2](./images/part_7.1_ws22_ping_r1_v2.png "Пинг есть")
- ![part 7.6 r2](./images/part_7.6_r2.png "Содержимое firewall.sh")
- ![part 7.6 ws22](./images/part_7.6_ws22_SNAT.png "Проверка tcp соединания SNAT")
- ![part 7.6 r1](./images/part_7.6_r1_DNAT.png "Проверка tcp соединения DNAT")
### Part 8. Дополнительно. Знакомство с SSH Tunnels
- ![part 8.1 ws22](./images/part_8.1_ws22_apache2.png "Вывод настроек apache")
- ![part 8.1 ws21](./images/part_8.1_ws21_local_tcp.png "Подключение к веб-серверу")
- Для установления local TCP forwarding я использовал программу ssh c указанием локального порта 9999
- ![part 8.1 ws21](./images/part_8.1_ws21_telnet.png "Исползование telnet для проверки соединения")
- Для remote TCP forwarding использовал то же самое, но с флагом -R
- ![part 8.1 ws11](./images/part_8.1_ws11.png "Подключение к серверу")
- ![part 8.1 ws11 telnet](./images/part_8.1_ws11_telnet.png "Использовал telnet для проверки соединения")
